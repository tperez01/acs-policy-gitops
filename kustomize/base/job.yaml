apiVersion: batch/v1
kind: Job
metadata:
  generateName: import-acs-policy-
  namespace: stackrox
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: HookSucceeded
spec:
  template:
    metadata:
    spec:
      containers:
      - command:
        - /bin/bash
        - -c
        - |
          #!/usr/bin/env bash
          curl -sk -X POST -u "admin:$PASSWORD" -H "Content-Type: application/json" --data @/etc/policies/policies.json "https://central/v1/policies/import"
        volumeMounts:
          - name: config-volume
            mountPath: /etc/policies/
        env:
        - name: PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: acs-password     
        image: image-registry.openshift-image-registry.svc:5000/openshift/cli:latest
        imagePullPolicy: Always
        name: import-acs-policy
      volumes:
        - name: config-volume
          configMap:
            name: policy-gitops
      restartPolicy: Never 
      dnsPolicy: ClusterFirst
      terminationGracePeriodSeconds: 30